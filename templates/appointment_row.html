{% load appointment_tags %}
<td>
        {%if appointment.visit_definition.code == visit_code%}
            <B>
        {% endif %}

        {{ appointment.visit_definition.code }}.{{ appointment.visit_instance }}
        

        {%if appointment.visit_definition.code == visit_code %}
            </B>
        {% endif %}
        
</td>
<td>    {%if appointment.visit_definition.code == visit_code%}
            <B>
        {% endif %}
    
        {{ appointment.visit_definition.title }}
    
        {%if appointment.visit_definition.code == visit_code %}
            </B>
        {% endif %}
</td>
<td>{{ appointment.appt_datetime|date:"Y-m-d" }}</td>
<td>
<A href="{{ appointment.get_absolute_url }}?next=dashboard_url&dashboard_type={{ dashboard_type }}&registered_subject={{ registered_subject.pk }}">
    {{ appointment.get_appt_status_display }}
    {% if appointment.appt_status == 'incomplete'%}<font color="red">*</font>{% endif %}
    {% if appointment.appt_status == 'in_progress'%}<font color="green">*</font>{% endif %}    
</A> {% if appointment.appt_status == 'incomplete'%}&nbsp;{% continuation_appointment_anchor appointment dashboard_type %}{% endif %}
</td>

{% if appointment_visit_report %}
    <td><A href="{{ visit_model_instance.get_absolute_url }}?next=dashboard_url&dashboard_type={{ dashboard_type }}&subject_identifier={{ subject_identifier }}&appointment={{ appointment.pk }}">{{visit_model_instance.report_datetime|date:"Y-m-d"}}</A></td>
    <td>{%if appointment.visit_definition.code == visit_code%}
        <B>
    {% endif %}
    {{visit_model_instance.reason}}
    {%if appointment.visit_definition.code == visit_code %}
        </B>
    {% endif %}</td>
    
{% else %}    
    <td><A href="{{ visit_model_add_url }}?next=dashboard_url&dashboard_type={{ dashboard_type }}&subject_identifier={{ subject_identifier }}&appointment={{ appointment.pk }}">Add</A></td>            
    <td></td>                
{% endif%}

{% if appointment_visit_report %}
    {% if appointment.visit_definition.code == visit_code and appointment.visit_instance == visit_instance %}
        <td><A href="{% url dashboard_url dashboard_type=dashboard_type subject_identifier=subject_identifier %}">show appointments</A></td>
    {% else %}
        <td><A href="{% url dashboard_visit_url dashboard_type=dashboard_type subject_identifier=subject_identifier visit_code=appointment.visit_definition.code visit_instance=appointment.visit_instance %}">show entry forms</A></td>                    
    {% endif %}
{% else %}
    <td><A href="{{ visit_model_add_url }}?next=dashboard_url&dashboard_type={{ dashboard_type }}&subject_identifier={{ subject_identifier }}&appointment={{ appointment.pk }}">add Visit Report for for {{ appointment.visit_definition.code }}.{{ appointment.visit_instance }}</A></td>
{% endif%}


