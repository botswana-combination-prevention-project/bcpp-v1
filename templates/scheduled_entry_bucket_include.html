{% load common_tags %}
{% load registered_subject_dashboard_tags %}

<table>
<thead>
<th></th>
<th>#</th>
<th>Title</th>
<th>Status</th>
<th>Due</th>
<th>Reported</th>
<th>User</th>                        
<th>Modified</th>                        
<th>Comment</th>        
<th>Close</th>
<th>Browse</th>                        
<th>Audit</th>                
</thead>
<tbody>
{% if not scheduled_entry_bucket %}
    <tr class="{% cycle 'row1' 'row2' %}"><td colspan="12"></td></tr>
{% else %}                
    {% for f in scheduled_entry_bucket %}
        <tr class="{% cycle 'row1' 'row2' %}">
        <td><span {% if f.entry_status == 'NEW'%}style="background:red;"{% endif %}>&nbsp;</span></td>
        <td>{{ forloop.counter }}</td>
        {% if f.entry_status == 'NEW' or f.entry_status == 'KEYED' or f.entry_status == 'QUERY' %}            
            {% if appointment.appt_status == 'in_progress' %}
             <td><A href="{% model_admin_url f.entry.content_type_map.content_type visit_model appointment dashboard_type app_label extra_url_context %}">{{ f.entry.content_type_map.content_type|model_verbose_name|title }}</A></td>
            {% else %}                
                <td>{{ f.entry.content_type_map.content_type|model_verbose_name|title }}</td>
            {% endif %}                                 
        {% else %}                
            <td>{{ f.entry.content_type_map.content_type|model_verbose_name|title }}</td>
        {% endif %}                
        <td><A href="{{ f.get_absolute_url }}?next=dashboard_visit_url&dashboard_type={{ dashboard_type }}&subject_identifier={{ subject_identifier }}&visit_code={{f.entry.visit_definition.code}}&visit_instance={{ visit_instance}}&content_type_map={{f.entry.content_type_map.model}}{{extra_url_context}}">{{ f.get_entry_status_display }}</A></td>
        <td>{{ f.due_datetime|date:"Y-m-d" }}</td>
        <td>{{ f.report_datetime|date:"Y-m-d" }}</td>
        <td>{% if not f.user_modified %}{{ f.user_created }}{% else %}{{ f.user_modified }}{% endif %}</td>            
        <td>{% if not f.entry_status == 'NEW' %}{{ f.modified|date:"Y-m-d H:i" }}{% endif %}</td>                            
        <td>{{ f.entry_comment }}</td>        
        <td>{{ f.close_datetime|date:"Y-m-d" }}</td>
        <td>{% comment %}{% if appointment %}{% if not f.entry_status == 'NEW' and not f.entry_status == 'NOT_REQUIRED' %}<A href="/databrowse/{{ f.entry.content_type_map.app_label }}/{{f.entry.content_type_map.model }}/objects/{% model_pk f.entry.content_type_map.content_type visit_model appointment dashboard_type app_label %}">Browse</A>{% endif %}{% endif %}{% endcomment %}</td>
        <td><A href="/audit_trail/{{ f.entry.content_type_map.app_label }}/{{ f.entry.content_type_map.model }}/{{ subject_identifier }}/?visit_code={{f.entry.visit_definition.code}}&visit_instance={{ visit_instance}}&back_url_name=dashboard_visit_url&dashboard_type={{ dashboard_type }}{{ extra_url_context|default:""}}">audit trail</a></td>
        
        </tr>
    {% endfor %}
{% endif %}
</tbody>
</table>

