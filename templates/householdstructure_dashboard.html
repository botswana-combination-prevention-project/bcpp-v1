{% extends "section_bcpp_household.html"%}
{% load common_tags %}{% load dashboard_tags %}
{% load crypto_tags %}
{% load dispatch_tags %}
{% load admin_urls %}
{% load url from future %}

{% block breadcrumbs %}

    {% load tags %}
    <div class="breadcrumbs">
        <a href="/{{ home }}">Home</a>
        &rsaquo; <a href="{% url 'section_url' section_name='household'%}">Household</a>        
        &rsaquo; <a href="{% url 'section_url' section_name='household' search_term=dashboard_identifier %}">{{dashboard_identifier}}</a>        
        {% if survey %}
            &rsaquo; {{ survey.survey_slug|capfirst }}
        {% endif %}    
    </div>
    
{% endblock %}

{% block section_tiles%}{% endblock %}

{% block dashboard %}
	{% if household.household_identifier|is_dispatched %}
	<div align="center"><h1>This household is currently <font color="red">dispatched</font> to a netbook. Please do not make any changes to it or it's members.</h1></div>
	{% endif %}
    {% block dashboard_marquee %}
    
        {% if not survey %}
            <table>
            <tr style="background:lightyellow;">
            <td><b>Household:&nbsp;</b>{{ household.household_identifier }}</td>
            <td><b>Ward:</b> {{ household.ward|encrypted }}</td>
            {% if household.cso_number %}<td><b>CSO:</b> {{ household.cso_number|encrypted}} </td>{% endif %}
            </tr>
            </table>

            <table>
            {% for survey in surveys %}
                <tr><td><A href="{% url 'household_dashboard_url' dashboard_type=dashboard_type household_identifier=household.household_identifier survey=survey.survey_slug %}">{{survey.survey_name}}</A></td></tr>                             
            {% endfor %}
            </table>
            

        {% else %}
            <table>
            <tr style="background:lightyellow;">
            <td><b>Household:&nbsp;</b>
	            {% if household|is_dispatched %}
	            	{{ household.household_identifier }}
	            {% else %}
	            	<A title="change household description" href="{% url household_meta|admin_urlname:'change' household.pk %}?next=household_dashboard_url&dashboard_type={{ dashboard_type }}&household_identifier={{ household.household_identifier }}">{{ household.household_identifier }}</A>
	            {% endif %}
            </td>
            <td><b>Section:</b> {{ household.section|encrypted }}-{{ household.sub_section|encrypted }}</td>
            <td><b>CSO:</b> {{ household.cso_number|encrypted|default:'?' }}</td>
            {% if household_structure %}
                <td><b>Members:&nbsp;</b>
                {% if household|is_dispatched %}
                	{{current_member_count}}/{{ household_structure.member_count }}
                {% else %}
                	<A title="change number of members" {% if allow_edit_members %} href="{{ household_structure.get_absolute_url }}?household={{ household_structure.household.pk }}&next=household_dashboard_url&dashboard_type={{ dashboard_type }}&household_identifier={{ household.household_identifier }}&household_structure={{ household_structure.pk}}" {% endif %}>{{current_member_count}}/{{ household_structure.member_count }}</A>
                {% endif %}
                </td>
            {% endif %}
            
            {% comment %}Update progress indicator for members{% endcomment%}
            {% for household_member in household_members %}
                 <td
                {% if not household_member.present == 'Yes' and not household_member.present == 'No'%}
                    style="background-color:red">?
                {% else %}                     
                    style="background-color:lightyellow">*
                {% endif %}    
                </td>                
            {% endfor %}    
            
            {% comment %}Link to google map or saved map {% endcomment%}
            <td>
                {% if household.uploaded_map %}
    				<a href="{{ STATIC_URL }}images/{{ household.uploaded_map }}">Saved Map</a>
                {% else %}
    				<a href="/bcpp_map/subject_map/?lon={{ household_structure.household.lon }}&lat={{ household_structure.household.lat }}&identifier={{ household_structure.household.household_identifier }}">Google Map</a>
    			{% endif %}
    		</td>
            </tr>
            </table>
            
            
            <table>
            <tr>
                {% if not household|is_dispatched %}
	                {% if household_structure %}
	                    {% if allow_edit_members %}
	                        <td><A href="{{ household_structure.get_absolute_url }}?household={{ household_structure.household.pk }}&next=household_dashboard_url&dashboard_type={{ dashboard_type }}&household_identifier={{ household.household_identifier }}&household_structure={{ household_structure.pk }}">change number of members</A></td>
	                        {% if household_structure.member_count > current_member_count %}
	                        <td>|&nbsp;<A href="{% url household_member_meta|admin_urlname:'add' %}?household_structure={{ household_structure.pk }}&next=household_dashboard_url&dashboard_type={{ dashboard_type }}&household_identifier={{ household_structure.household.household_identifier }}&household_structure={{ household_structure.pk }}"><img src="/static/admin/img/icon_addlink.gif" width="10" height="10">&nbsp; Add another household member</A></td>
	                        {% endif %}
	                    {% endif %}                        
	                {% else %}
	                    {% if allow_edit_members %}
	                        <td><A name="add-householdstructure-{{survey.survey_name}}" href="{% url household_structure_meta|admin_urlname:'add' %}?household={{household.pk}}&next=household_dashboard_url&dashboard_type={{ dashboard_type }}&household_identifier={{ household.household_identifier }}">add household structure for {{survey.survey_name}}</A></td>        
	                    {% endif %}                        
	                {% endif %}
	             {% endif %}
            </tr>        
            </table>
        {% endif %}        
    {% endblock %}

    {% if survey %}
        {% if household_structure %}
            {% include "householdmember_dashboard_include.html" %}
            {% if allow_edit_members %}
                {% if household_structure.member_count > current_member_count %}
                    <p>&nbsp;<A name="add-another-householdmember" href="{% url household_member_meta|admin_urlname:'add' %}?household_structure={{ household_structure.pk }}&next=household_dashboard_url&dashboard_type={{ dashboard_type }}&household_identifier={{ household_structure.household.household_identifier }}"><img src="/static/admin/img/icon_addlink.gif" width="10" height="10">&nbsp; Add another household member</A></p>
                {% endif %}
            {% endif %}
            <ol>
            <li>Present on day of survey visit
            <li>Must be between 16 and 64 years old. 16 and 17 year olds are minors to be accompanied by a guardian during the consent process.
            </ol>
            
            <table>
            <tr style="background:lightyellow;">
            <td><b>Comment:</b> {{ household.comment|wordwrap:80 }}</td>
            </tr>
            </table> 
              
        {% endif%}
    {% endif%}

       {% include "household_log_include.html" %}

       {% include "householdmember_contacts_include.html" %}
    
            <H4>Surveys</H4>    
            <table>
            {% for s in surveys %}
                {% if s == survey %}
                    <tr><td>{{s.survey_name}}</td><td><span style="color:green"><small>selected</small></span></td><td>{{ s.datetime_start}}</td><td>{{ s.datetime_end}}</td></tr>
                {% else %}
                    <tr><td><A href="{% url 'household_dashboard_url' dashboard_type=dashboard_type household_identifier=household.household_identifier household_structure=household_structure.pk %}">{{s.survey_name}}</A></td><td></td></tr>                             
                {% endif %}
            {% endfor %}
            </table>
       

{% endblock dashboard %}


