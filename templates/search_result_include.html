{% load crypto_tags %}
{% load dispatch_tags %}
{% load admin_urls %}
{% load url from future %}
{% load common_tags %}

<div class="results">
    <table  cellspacing="0" id="result_list">
	<thead>
	<th>Action</th>
	<th>Household</th>
	<th>Status</th>
	<th>CSO</th>
	<th>Community</th>
	<th>Section</th>
    <th>Sub-section</th>
    <th>m</th>
	<th>Modified</th>    	    	
	<th>Host</th> 
	<th>Map</th>    	    	    		    	    	    	
	</thead>	
    {% for household in search_result.object_list %}
        <!-- obj is a Household object -->

        <tr class="{% cycle 'row1' 'row2' %}">

        <td>
          {% if household|is_dispatched %}
            <div class="warning">Locked</div>{{ household.action }}
          {% else %}
            {% if household.action == 'confirmed'%}
                <A name="dashboard-{{household.household_identifier}}" href="{% url 'household_dashboard_url' dashboard_type='household' dashboard_model='household' dashboard_id=household.pk %}">Composition</A>
            {% else %}
                {{ household.action }}
            {% endif %}
          {% endif %}
        </td>

        <td>{% if household|is_dispatched %}
        		<div class="warning">{{household.household_identifier}}</div>
        	{% else %}
        		<A href="{% url household|get_meta|admin_urlname:'change' household.pk %}?next=household_dashboard_url&dashboard_type=household&dashboard_model=household&dashboard_id={{ household.pk }}">{{ household }}</A>
        	{% endif %}
        	</td>
          <td>{{ household.get_status_display }}</td>
     	  <td>{{ household.cso_number|encrypted }}</td>
     	  <td>{{ household.community|encrypted}}</td>
     	  <td>{{ household.section|encrypted }}</td>     	  
          <td>{{ household.sub_section|encrypted }}</td>          
      	  <td>{{ household.relative_distance }}</td>
      	  <td>{{ household.modified|default:household.created|date:"Y-m-d" }}</td>
       	  <td>{{ household.user_modified }}</td>
       	  <td>
       	        {% if household.uploaded_map %}
    				<a href="{{ STATIC_URL }}images/{{ household.uploaded_map }}">view saved map</a>
                {% else %}
                    {% if household.gps_lon|default:household.gps_target_lon and household.gps_lat|default:household.gps_target_lat %}
                	  <form action="{% url 'subject_map_url' mapper_name=mapper_name identifier=household.household_identifier lon=household.gps_lon|default:household.gps_target_lon lat=household.gps_lat|default:household.gps_target_lat %}" method="post">
					   	{% csrf_token %}
						<p><input type="submit" value="view google map"></p>
					  </form>
					{% else %}
					   <span style="background-color:red;color:white;"> missing lat/lon!</span>
					{% endif %}	
				{% endif %}
       	  
       	  </td>    	  
        </tr>
        
    {% endfor %}
    <tr><td colspan="11">{{ search_result.object_list.count|default:0 }} household structure{{ search_result.object_list|pluralize }}{% if not search_result.object_list.count%}s{%endif%} found.</td></tr>    
</table>
</div>
