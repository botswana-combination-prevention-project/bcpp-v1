{% extends "base_registered_subject_dashboard.html"%}{% load crypto_tags %}
{% load common_tags %}{% load dashboard_tags %}
{% load crypto_tags %}
{% load admin_urls %}
{% load url from future %}

{% block breadcrumbs %}

    {% load tags %}
    <div class="breadcrumbs">
        <a href="/{{ home }}">Home</a>
        &rsaquo; <a href="{% url 'section_url' section_name='household'%}">Household</a>
        &rsaquo; <a href="{% url household_dashboard_url dashboard_type='household' dashboard_model='household_structure' dashboard_id=household_structure.pk %}">{{ household_structure }} {{ household_structure.survey.survey_slug|capfirst }}</a>        
        &rsaquo; {{ registered_subject.subject_identifier|mask_pk:'subject identifier pending' }}
    </div>
    
{% endblock %}

{% block clinic_dashboard_marquee %}
<table>
<tr style="background:lightyellow;">
<td><B>Name:</B> {{ household_member.first_name|encrypted }} ({{ household_member.initials }})</td> 
<td><B>Gender:</B> {{ household_member.gender|gender }}</td>
<td><B>Age at Survey:</B> {{ household_member.age_in_years }}</td>  
{% if subject_consent %}
    {% if not subject_consent.first_name == household_member.first_name %}
        <td><div style="background:red;color:white;">Name mismatch: {{ subject_consent.first_name|encrypted }} <> {{household_member.first_name|encrypted}}</div></td>  
    {% endif %}
{% else %}    
    <td></td>  
{% endif %}
</tr>
</table>
<table>
<tr style="background:lightyellow;">
{% if subject_consent %}
    <td><B>Survey Consent:</B> {{subject_consent.survey.survey_name }}</td>
    <td><B>Identifier:</B> {{subject_consent.subject_identifier }}</td>
    <td><B>{{subject_consent.identity_type|capfirst }}:</B> {{subject_consent.identity|encrypted }}</td>      
    <td><B>Born:</B> {{subject_consent.dob|date:"Y-m-d" }}</td> 
    <td><B>Age:</B> {{subject_consent.dob|age }}</td>
    <td><B>Date:</B> {{subject_consent.consent_datetime|date:"Y-m-d H:i" }}</td>
{% endif %}
</tr>
</table>
{% if subject_hiv_result %}
<table>
<tr style="background:lightyellow;">
    <td><B>Result: </B>{{ subject_hiv_result.subject_hiv_result_option }}</td>
    <td><B>Finger-prick: </B>{{ subject_hiv_result.sample_datetime_drawn|date:"Y-m-d H:i"  }}</td>    
    <td><B>Release: </B>{{ subject_hiv_result.result_release_location }}</td>        
</tr>
</table>
{% endif %}

{% endblock %}

{% block membership_forms %}
	{% if household_member.is_dispatched %}
         Forms locked! because this {{ household_member.first_name|encrypted }} is in household that is currently dispatched to a netbook.
    {% else %}
        {{ block.super }}
	{% endif %}
{% endblock %}

{% block appointment_continuation %}{% endblock %}

{% block side_bar_right_1 %}
    {% if not household %}    
        <H4>Household</H4>
        Household unknown
    {% else %}
        <tr name="top right"><td>
        <B>Household <A title="go to household" href="{% url household_dashboard_url dashboard_type='household' dashboard_model='household_structure' dashboard_id=household_structure.pk %}">{{ household.household_identifier }}</A></B>
        <table>
            <tr><td>{{ survey.survey_name }}</td><td colspan="2">CSO {{ household.cso_number|encrypted }}</td></tr>

        {% if household_members %}
            {% for hsm in household_members %}
                <tr {% if hsm.first_name == household_member.first_name%}style="background:lightyellow;"{% else %}class="row1"{% endif %}>
                <td>
                {% if hsm.is_eligible and not hsm.present == '-' %}
                    {{ forloop.counter }}.&nbsp;<A href="{% url subject_dashboard_url dashboard_type=dashboard_type dashboard_model='household_member' dashboard_id=household_member.pk show='appointments' %}">{% if hsm.first_name == household_member.first_name%}<B>{% endif %}{{ hsm.first_name|encrypted }}&nbsp;{{ hsm.gender }}&nbsp;{{ hsm.age_in_years }}&nbsp;{{ hsm.hiv_status }}</A>{% if hsm.first_name == household_member.first_name%}</B>{% endif %}
                {% else%}                
                    {{ forloop.counter }}.&nbsp;{{ hsm.first_name|encrypted }}&nbsp;{{ hsm.gender }}&nbsp;{{ hsm.age_in_years }}            
                {% endif %}
                {% if hsm.present == '-' %}
                    <span style="color:red;font-size:9px;vertical-align:super">Update!</span>
                {% endif %}                    
                </td>            
                <td>{{ hsm.household_structure_relation }}</td>
                <td>
                {% if hsm.member_status %}
                    {{ hsm.member_status }}
                {% else %}    
                    {{ hsm.is_eligible_label }}            
                {% endif %}
                </td>
                </tr>
            {% endfor %}
        {% else %}    
            <tr><td colspan="3">no members</td></tr>
        {% endif %}
        </table>        

        </td></tr>
    {% endif %}
{% endblock side_bar_right_1 %}    

