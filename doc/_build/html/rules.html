

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Building Model Rules &mdash; bhp_bucket 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="bhp_bucket 1.0 documentation" href="index.html" />
    <link rel="next" title="Classes" href="classes.html" />
    <link rel="prev" title="Overview" href="overview.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="classes.html" title="Classes"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="overview.html" title="Overview"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">bhp_bucket 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="building-model-rules">
<h1>Building Model Rules<a class="headerlink" href="#building-model-rules" title="Permalink to this headline">Â¶</a></h1>
<p>The order in which the classes are listed matters. If rules refer to the same
model, only the result of the last rule will matter. In the example below,
the target_model &#8216;hivhistorycd4&#8217; is referred to in HivHistoryBucket and ObHistoryBucket.
Since ObHistoryBucket rules will run last, the result of the HivHistoryBucket
rule referring to target_model &#8216;hivhistorycd4&#8217; will be overwritten.</p>
<p>to the bucket.py in the app add something like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">HivHistoryBucket</span><span class="p">(</span><span class="n">ModelBucket</span><span class="p">):</span>

    <span class="n">has_cd4</span> <span class="o">=</span> <span class="n">ScheduledModelRule</span><span class="p">(</span>
        <span class="n">logic</span> <span class="o">=</span> <span class="p">((</span><span class="s">&#39;has_cd4&#39;</span><span class="p">,</span> <span class="s">&#39;equals&#39;</span><span class="p">,</span> <span class="s">&#39;yes&#39;</span><span class="p">),</span> <span class="s">&#39;new&#39;</span><span class="p">,</span> <span class="s">&#39;not_required&#39;</span><span class="p">),</span>
        <span class="n">target_model</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;hivhistorycd4&#39;</span><span class="p">]</span> <span class="p">,</span>
        <span class="n">visit_model_fieldname</span> <span class="o">=</span> <span class="s">&#39;maternal_visit&#39;</span><span class="p">,</span>
         <span class="p">)</span>

    <span class="n">arv</span> <span class="o">=</span> <span class="n">ScheduledModelRule</span><span class="p">(</span>
        <span class="n">logic</span> <span class="o">=</span> <span class="p">(((</span><span class="s">&#39;on_cont_arv&#39;</span><span class="p">,</span> <span class="s">&#39;equals&#39;</span><span class="p">,</span> <span class="s">&#39;yes&#39;</span><span class="p">),(</span><span class="s">&#39;init_arv&#39;</span><span class="p">,</span> <span class="s">&#39;equals&#39;</span><span class="p">,</span> <span class="s">&#39;yes&#39;</span><span class="p">,</span> <span class="s">&#39;or&#39;</span><span class="p">)),</span> <span class="s">&#39;new&#39;</span><span class="p">,</span> <span class="s">&#39;not_required&#39;</span><span class="p">),</span>
        <span class="n">target_model</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;hivhistoryarv&#39;</span><span class="p">],</span>
        <span class="n">visit_model_fieldname</span> <span class="o">=</span> <span class="s">&#39;maternal_visit&#39;</span><span class="p">,</span>
         <span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s">&#39;maikalelo_maternal&#39;</span>

<span class="n">bucket</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">HivHistory</span><span class="p">,</span> <span class="n">HivHistoryBucket</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ObHistoryBucket</span><span class="p">(</span><span class="n">ModelBucket</span><span class="p">):</span>

    <span class="n">is_hiv_pos</span> <span class="o">=</span> <span class="n">ScheduledModelRule</span><span class="p">(</span>
        <span class="n">reference_model</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;maikalelo_maternal&#39;</span><span class="p">,</span><span class="s">&#39;maternalenrollment&#39;</span><span class="p">,),</span>
        <span class="n">reference_model_filter</span> <span class="o">=</span> <span class="s">&#39;registered_subject&#39;</span><span class="p">,</span>
        <span class="n">logic</span> <span class="o">=</span> <span class="p">((</span><span class="s">&#39;is_hiv_pos&#39;</span><span class="p">,</span> <span class="s">&#39;equals&#39;</span><span class="p">,</span> <span class="s">&#39;yes&#39;</span><span class="p">),</span> <span class="s">&#39;new&#39;</span><span class="p">,</span> <span class="s">&#39;not_required&#39;</span><span class="p">),</span>
        <span class="n">target_model</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;demographichiv&#39;</span><span class="p">,</span><span class="s">&#39;deliveryhiv&#39;</span><span class="p">,</span><span class="s">&#39;hivhistory&#39;</span><span class="p">,</span>
                        <span class="s">&#39;hivhistorycd4&#39;</span><span class="p">,</span> <span class="s">&#39;hivhistoryvl&#39;</span><span class="p">,</span><span class="s">&#39;hivhistorytest&#39;</span><span class="p">,</span> <span class="s">&#39;hivhistoryarv&#39;</span><span class="p">],</span>
        <span class="n">visit_model_fieldname</span> <span class="o">=</span> <span class="s">&#39;maternal_visit&#39;</span><span class="p">,</span>
         <span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s">&#39;maikalelo_maternal&#39;</span>

<span class="n">bucket</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">ObHistory</span><span class="p">,</span> <span class="n">ObHistoryBucket</span><span class="p">)</span>
</pre></div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="overview.html"
                        title="previous chapter">Overview</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="classes.html"
                        title="next chapter">Classes</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/rules.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="classes.html" title="Classes"
             >next</a> |</li>
        <li class="right" >
          <a href="overview.html" title="Overview"
             >previous</a> |</li>
        <li><a href="index.html">bhp_bucket 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, erik van widenfelt.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>