{% load crypto_tags %}
{% load dispatch_tags %}
{% load admin_urls %}
{% load url from future %}
{% load common_tags %}

<div class="results">

<table  cellspacing="0" id="result_list">
<thead>
<th>Action</th>
<th>Plot</th>
<th>Status</th>
<th>Community</th>
<th>Modified</th>           
<th>Host</th> 
<th>Map</th>                                  
</thead>  

{% for plot in search_result.object_list %}
    {% if plot %}
      <!-- obj is a plot object -->

      <tr class="{% cycle 'row1' 'row2' %}">

      <td>
        {% if plot|is_dispatched %}
          <div class="warning">Locked</div>{{ plot.action }}
        {% else %}
          {% if plot.action == 'confirmed'%}
              <A name="dashboard-{{plot.plot_identifier}}" href="{% url 'plot_dashboard_url' dashboard_type='plot' dashboard_model='plot' dashboard_id=plot.pk %}">Composition</A>
          {% else %}
              {{ plot.action }}
          {% endif %}
        {% endif %}
      </td>

      <td>{% if plot|is_dispatched %}
          <div class="warning">{{plot.plot_identifier}}</div>
        {% else %}
          {% if not plot.pk %}
            <span style="background-color:red;color:white;">Error: No Plot!!</span>
          {% else %}
            <A href="{% url plot|get_meta|admin_urlname:'change' plot.pk %}?next=plot_dashboard_url&dashboard_type=plot&dashboard_model=plot&dashboard_id={{ plot.pk }}">{{ plot }}</A>
          {% endif %}
        {% endif %}
        </td>
        <td>{{ plot.get_status_display }}</td>
      <td>{{ plot.community|encrypted}}</td>
        <td>{{ plot.modified|default:plot.created|date:"Y-m-d" }}</td>
        <td>{{ plot.user_modified }}</td>
        <td>
              {% if plot.uploaded_map %}
          <a href="{{ MEDIA_URL }}{{ plot.uploaded_map }}"/>view saved map</a>
              {% else %}
                  {% if plot.gps_lon|default:plot.gps_target_lon and plot.gps_lat|default:plot.gps_target_lat %}
                  <form action="{% url 'item_map_url' mapper_name=plot.community identifier=plot.plot_identifier lon=plot.gps_lon|default:plot.gps_target_lon lat=plot.gps_lat|default:plot.gps_target_lat %}" method="post">
            {% csrf_token %}
          <p><input type="submit" value="view google map"></p>
          </form>
        {% else %}
           <span style="background-color:red;color:white;"> missing lat/lon!</span>
        {% endif %} 
      {% endif %}
        
        </td>       
      </tr>
      {% endif %}
{% endfor %}
  <tr><td colspan="11">{{ search_result.object_list.count|default:0 }} plot structure{{ search_result.object_list|pluralize }}{% if not search_result.object_list.count%}s{%endif%} found.</td></tr>    
</table>


</div>
<div class="pagination">
    <span class="step-links">
        {% if search_result.has_previous %}
            <a href="?page={{ search_result.previous_page_number }}">previous</a>
        {% endif %}

        <span class="current">
            Page {{ search_result.number }} of {{ search_result.paginator.num_pages }}.
        </span>

        {% if search_result.has_next %}
            <a href="?page={{ search_result.next_page_number }}">next</a>
        {% endif %}
    </span>
</div>


